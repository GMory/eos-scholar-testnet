<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>EOSIO Scholar Testnet</title>
  <script src="src/js/echarts.min.js"></script>
  <script src="src/js/bmap.min.js"></script>
  <script src="src/js/world.js"></script>
  <script src="producer.js"></script>
</head>
<body>
<div id="main" style="position:fixed;top:0;right:0;bottom:0;left:0;"></div>
<script type="text/javascript">
var myChart = echarts.init(document.getElementById('main'));

var data = producerList;

function formtVData(data) {
  var tGeoDt = [];
  for (var i = 0, len = data.length; i < len; i++) {
    var tNam = data[i].name;
    tGeoDt.push({
      name: tNam,
      value: data[i].LngLat
    });
  }
  return tGeoDt;
}

var convertData = function (data, from) {
  var res = [];
  for (var i = 0; i < data.length; i++) {
    var dataItem = data[i];
    var fromCoord = data[from].LngLat;
    var toCoord = data[i].LngLat;
    if (fromCoord && toCoord) {
      res.push([{
        coord: fromCoord
      }, {
        coord: toCoord,
        value: dataItem.LngLat
      }]);
    }
  }
  return res;
};

function getInitSeries() {
  return [{
    type: 'effectScatter',
    coordinateSystem: 'geo',
    zlevel: 2,
    rippleEffect: {
      brushType: 'stroke'
    },
    symbolSize: 20,
    itemStyle: {
      normal: {
        color: 'skyblue'
      },
      emphasis: {
        color: 'skyblue'
      }
    },
    data: formtVData(data)
  }];
}
var series = getInitSeries();

var option = {
  backgroundColor: '#00000',
  title: {
    text: 'EOSIO Scholar Testnet',
    left: 'center'
  },
  geo: {
    type: 'map',
    map: 'world',
    roam: true,
    itemStyle: {
      normal: {
        areaColor: 'white',
        borderColor: 'black'
      },
      emphasis: {
        areaColor: 'white'
      }
    }
  },
  tooltip: {
    trigger: 'item',
    formatter: function (param) {
      return param.data.name;
    }
  },
  series: series
};

myChart.setOption(option);

var currentIndex = 0;

function render() {
  series = getInitSeries();
  series.push({
    type: 'lines',
    zlevel: 2,
    effect: {
      show: true,
      period: 0.5,
      trailLength: 0.01,
      symbol: 'arrow',
      symbolSize: 5
    },
    lineStyle: {
      normal: {
        color: 'green',
        width: 1
      }
    },
    data: convertData(data, currentIndex)
  });
  if (currentIndex < data.length - 1) {
    currentIndex++;
  } else {
    currentIndex = 0;
  }
  option.series = series;
  myChart.setOption(option);

  setTimeout(function () {
    render();
  }, 500);
}
render();
</script>
</body>
</html>
