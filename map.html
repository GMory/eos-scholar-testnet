<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>EOSIO Scholar Testnet</title>
  <script src="src/js/echarts.min.js"></script>
  <script src="src/js/bmap.min.js"></script>
  <script src="src/js/world.js"></script>
  <script src="producer.js"></script>
</head>
<body>
<div id="main" style="position:fixed;top:0;right:0;bottom:0;left:0;"></div>
<script type="text/javascript">
var myChart = echarts.init(document.getElementById('main'));

var data = producerList;

var convertData = function (data, from) {
  var res = [];
  for (var i = 0; i < data.length; i++) {
    var dataItem = data[i];
    var fromCoord = data[from].LngLat;
    var toCoord = data[i].LngLat;
    if (fromCoord && toCoord) {
      res.push([{
        coord: fromCoord
      }, {
        coord: toCoord,
        value: dataItem.LngLat
      }]);
    }
  }
  return res;
};

function getScatterStyle(isActive, data) {
  return {
    type: 'effectScatter',
    coordinateSystem: 'geo',
    zlevel: 2,
    rippleEffect: {
      brushType: isActive ? 'stroke' : 'none'
    },
    symbolSize: 20,
    itemStyle: {
      normal: {
        color: isActive ? 'lime' : 'orange'
      },
      emphasis: {
        color: isActive ? 'lime' : 'orange'
      }
    },
    data: data
  }
}

function getInitSeries() {
  var defaultProducer = [];
  var activeProducer = [];
  for (var i = 0, len = data.length; i < len; i++) {
    var tNam = data[i].name;
    if (i !== currentIndex) {
      defaultProducer.push({
        name: tNam,
        value: data[i].LngLat
      });
    } else {
      activeProducer.push({
        name: tNam,
        value: data[i].LngLat
      });
    }
  }

  return [getScatterStyle(false, defaultProducer), getScatterStyle(true, activeProducer)];
}

var series = getInitSeries();

var option = {
  backgroundColor: '#404a59',
  title: {
    text: 'EOSIO Scholar Testnet',
    left: 'center',
    textStyle: {
      color: '#fff'
    }
  },
  geo: {
    type: 'map',
    map: 'world',
    roam: true,
    itemStyle: {
      normal: {
        color: 'rgba(51, 69, 89, .5)',
        borderColor: 'rgba(100,149,237,1)'
      },
      emphasis: {
        color: 'rgba(37, 43, 61, .5)'
      }
    }
  },
  tooltip: {
    trigger: 'item',
    formatter: function (param) {
      return param.data.name;
    }
  },
  series: series
};

myChart.setOption(option);

var currentIndex = 0;

function render() {
  series = getInitSeries();

  series.push({
    type: 'lines',
    zlevel: 2,
    effect: {
      show: true,
      period: 2,
      trailLength: 0.01,
      symbol: 'arrow',
      symbolSize: 5
    },
    lineStyle: {
      normal: {
        color: 'lime',
        width: 1
      }
    },
    data: convertData(data, currentIndex)
  });
  if (currentIndex < data.length - 1) {
    currentIndex++;
  } else {
    currentIndex = 0;
  }
  option.series = series;
  myChart.setOption(option);

  setTimeout(function () {
    render();
  }, 500);
}

render();
</script>
</body>
</html>
